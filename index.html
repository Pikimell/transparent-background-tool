<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transparent Background Tool</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for better visual experience */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f9;
        }
        /* Style for the canvas to show the transparency effect */
        #processedCanvas {
            box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.1); /* Subtle border */
            background-image: linear-gradient(45deg, #ccc 25%, transparent 25%),
                              linear-gradient(-45deg, #ccc 25%, transparent 25%),
                              linear-gradient(45deg, transparent 75%, #ccc 75%),
                              linear-gradient(-45deg, transparent 75%, #ccc 75%);
            background-size: 16px 16px;
            background-position: 0 0, 0 8px, 8px -8px, -8px 0px;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div id="appContainer" class="w-full max-w-4xl bg-white p-6 md:p-10 rounded-xl shadow-2xl space-y-8">
        <header class="text-center space-y-2">
            <h1 class="text-4xl font-extrabold text-gray-800">Magic Background Remover</h1>
            <p class="text-gray-500">Upload a picture with a white background to make it transparent.</p>
        </header>

        <!-- File Upload Area -->
        <div class="border-2 border-dashed border-indigo-300 rounded-lg p-6 hover:border-indigo-500 transition duration-300 cursor-pointer">
            <input type="file" id="imageUpload" accept="image/*" class="hidden" onchange="handleImageUpload(event)">
            <label for="imageUpload" class="flex flex-col items-center justify-center space-y-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                </svg>
                <span class="text-lg font-semibold text-indigo-600">Click to upload image</span>
                <span class="text-sm text-gray-500">PNG, JPG, or GIF (max 10MB)</span>
            </label>
        </div>

        <!-- Status Message Area -->
        <div id="statusMessage" class="text-center font-medium h-6"></div>

        <!-- Image Processing and Preview Area -->
        <div id="previewArea" class="hidden flex flex-col md:flex-row gap-6">
            
            <div class="flex-1 space-y-3">
                <h2 class="text-xl font-semibold text-gray-700">Original Image</h2>
                <div class="border rounded-lg p-2 flex justify-center items-center bg-gray-100 min-h-[200px]">
                    <img id="originalImage" class="max-w-full max-h-[300px] rounded-lg" alt="Original Uploaded Image">
                </div>
            </div>

            <div class="flex-1 space-y-3">
                <h2 class="text-xl font-semibold text-gray-700">Result (Transparent)</h2>
                <div class="border rounded-lg p-2 flex justify-center items-center min-h-[200px]">
                    <!-- Canvas for the processed image -->
                    <canvas id="processedCanvas" class="max-w-full max-h-[300px] rounded-lg"></canvas>
                </div>
            </div>
        </div>

        <!-- Controls -->
        <div id="controls" class="hidden flex flex-col sm:flex-row justify-center gap-4 pt-4">
            <button id="processButton" onclick="processImage()" class="px-6 py-3 bg-indigo-600 text-white font-bold rounded-lg shadow-lg hover:bg-indigo-700 transition duration-150 transform hover:scale-105 disabled:opacity-50" disabled>
                Remove White Background
            </button>
            <a id="downloadLink" download="transparent_image.png" class="hidden">
                <button class="px-6 py-3 bg-green-500 text-white font-bold rounded-lg shadow-lg hover:bg-green-600 transition duration-150 transform hover:scale-105">
                    Download PNG
                </button>
            </a>
        </div>
    </div>

    <script>
        // Global references
        const statusMessage = document.getElementById('statusMessage');
        const imageUpload = document.getElementById('imageUpload');
        const originalImage = document.getElementById('originalImage');
        const processedCanvas = document.getElementById('processedCanvas');
        const previewArea = document.getElementById('previewArea');
        const processButton = document.getElementById('processButton');
        const downloadLink = document.getElementById('downloadLink');

        let originalImg = null; // Stores the HTML image element
        let ctx = processedCanvas.getContext('2d');

        /**
         * Converts the uploaded file into an image element and displays it.
         * @param {Event} event The file change event.
         */
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Reset UI
            statusMessage.textContent = '';
            processButton.disabled = true;
            downloadLink.classList.add('hidden');
            previewArea.classList.add('hidden');

            // Check file type
            if (!file.type.startsWith('image/')) {
                statusMessage.textContent = 'Please upload a valid image file.';
                statusMessage.classList.remove('text-green-500', 'text-red-500');
                statusMessage.classList.add('text-yellow-600');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                originalImage.src = e.target.result;
                originalImg = new Image();
                originalImg.onload = () => {
                    // Update UI state
                    previewArea.classList.remove('hidden');
                    document.getElementById('controls').classList.remove('hidden');
                    processButton.disabled = false;
                    statusMessage.textContent = 'Image uploaded. Ready to process.';
                    statusMessage.classList.remove('text-red-500', 'text-yellow-600');
                    statusMessage.classList.add('text-green-600');
                };
                originalImg.onerror = () => {
                    statusMessage.textContent = 'Error loading image.';
                    statusMessage.classList.add('text-red-500');
                    processButton.disabled = true;
                };
                originalImg.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        /**
         * Processes the image by setting white pixels to transparent.
         */
        function processImage() {
            if (!originalImg) {
                statusMessage.textContent = 'Please upload an image first.';
                statusMessage.classList.add('text-red-500');
                return;
            }

            statusMessage.textContent = 'Processing image...';
            processButton.disabled = true;
            downloadLink.classList.add('hidden');

            try {
                // 1. Set canvas size to match the original image
                const w = originalImg.width;
                const h = originalImg.height;
                processedCanvas.width = w;
                processedCanvas.height = h;

                // 2. Draw the image onto the canvas
                ctx.drawImage(originalImg, 0, 0, w, h);

                // 3. Get the pixel data
                const imageData = ctx.getImageData(0, 0, w, h);
                const data = imageData.data;

                // Define the tolerance for "white"
                // If R, G, and B are all above this value, we consider it white/near-white.
                const whiteThreshold = 245; 

                // 4. Iterate through all pixels (r, g, b, a)
                for (let i = 0; i < data.length; i += 4) {
                    const r = data[i];     // Red
                    const g = data[i + 1]; // Green
                    const b = data[i + 2]; // Blue

                    // Check if the pixel is close to white
                    if (r >= whiteThreshold && g >= whiteThreshold && b >= whiteThreshold) {
                        // Set Alpha channel (data[i + 3]) to 0 (fully transparent)
                        data[i + 3] = 0;
                    }
                }

                // 5. Put the modified pixel data back onto the canvas
                ctx.putImageData(imageData, 0, 0);

                // 6. Prepare the download link
                const dataURL = processedCanvas.toDataURL('image/png');
                downloadLink.href = dataURL;
                downloadLink.classList.remove('hidden');
                
                statusMessage.textContent = 'Processing complete! Download your transparent PNG.';
                statusMessage.classList.remove('text-red-500', 'text-yellow-600');
                statusMessage.classList.add('text-green-600');

            } catch (error) {
                console.error("Image processing failed:", error);
                statusMessage.textContent = 'An error occurred during processing.';
                statusMessage.classList.add('text-red-500');
            } finally {
                processButton.disabled = false;
            }
        }
    </script>
</body>
</html>
